<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop.mappers.shopMapper">

<!-- 카테고리별 상품 리스트 1차 분류-->
<select id="list_1" resultType="com.shop.domain.GoodsViewVO">
	select  g.goodsNum,
			g.goodsName,
			g.cateCode,
			c.cateCodeRef,
			c.cateName,
			goodsPrice,
			goodsStock,
			goodsDesc,
			goodsImg,
			goodsDate,
			g.goodsImg,
			g.goodsThumbImg
	from	tbl_goods g
	inner	join goods_category c
			on g.cateCode = c.cateCode
	where	g.cateCode = #{cateCode}
			or c.cateCodeRef = #{cateCodeRef}
</select>

<!-- 카테고리별 상품 리스트 2차 분류-->
<select id="list_2" resultType="com.shop.domain.GoodsViewVO">
	select  g.goodsNum,
			g.goodsName,
			g.cateCode,
			c.cateCodeRef,
			c.cateName,
			goodsPrice,
			goodsStock,
			goodsDesc,
			goodsImg,
			goodsDate,
			g.goodsImg,
			g.goodsThumbImg
	from tbl_goods g
	inner join goods_category c
	on g.cateCode = c.cateCode
	where g.cateCode = #{cateCode}
</select>

<!-- 상품 소감(댓글) 작성 -->
<insert id="registReply">
	insert into tbl_reply (
							goodsNum,
							userId,
							replyNum,
							replyCon
						  )
				 values	 (
				 			#{goodsNum},
				 			#{userId},
				 			tbl_reply_seq.nextval,
				 			#{replyCon}
				 		  )
</insert>

<!-- 상품 소감(댓글) 리스트 -->
<select id="replyList" resultType="com.shop.domain.ReplyListVO">
	select r.goodsNum,
		   r.userId,
		   r.replyNum,
		   r.replyCon,
		   r.replyDate,
		   m.userName
	from   tbl_reply r
	inner join tbl_member m
		on r.userId = m.userId
	where  goodsNum = #{goodsNum}
</select>

<!-- 상품 소감(댓글) 삭제 -->
<delete id="deleteReply">
	delete	tbl_reply
	where	replyNum = #{replyNum}
		and userId = #{userId}
</delete>

<!-- 아이디 체크 -->
<select id="replyUserIdCheck" resultType="String">
	select	userId
	from	tbl_reply
	where	replyNum = #{replyNum}
</select>

</mapper>